-- Agregar las columnas 'DESCRIPTION' y 'SCORE_VALUE' a la tabla
ALTER TABLE [T_RRHH_PERFORMANCE_EVALUATIONS_SCORES]
ADD 
    [DESCRIPTION] varchar(MAX) NOT NULL CHECK (
        LEN([DESCRIPTION]) > 0
        AND LEN([DESCRIPTION]) <= 255
    ),
    [SCORE_VALUE] int NOT NULL CHECK (
        [SCORE_VALUE] >= 0
        AND [SCORE_VALUE] <= 20
    );


-- Verificar la estructura de la tabla después de la modificación
EXEC sp_help 'T_RRHH_PERFORMANCE_EVALUATIONS_SCORES';

--MODIFICAR EL TAMANIO DE CARACTERERS
ALTER TABLE T_RRHH_PERFORMANCE_EVALUATIONS_SCORES
ALTER COLUMN DESCRIPTION varchar(500) NOT NULL;

ALTER TABLE T_RRHH_PERFORMANCE_EVALUATIONS_RECOMMENDATIONS
ALTER COLUMN RECOMMENDATION_NAME varchar(500) NOT NULL;




-- 1. Encontrar el nombre del constraint (ya lo hiciste)
SELECT CONSTRAINT_NAME 
FROM INFORMATION_SCHEMA.CONSTRAINT_COLUMN_USAGE 
WHERE TABLE_NAME = 'T_RRHH_PERFORMANCE_INFORMATIONAL_QUESTIONS' 
  AND COLUMN_NAME = 'QUESTION';

-- 2. Eliminar el constraint específico
ALTER TABLE [T_RRHH_PERFORMANCE_INFORMATIONAL_QUESTIONS]
DROP CONSTRAINT [UQ__T_RRHH_P__0B6FA2A6BD799857];

-- Eliminar el índice dependiente
DROP INDEX [T_RRHH_PERFORMANCE_INFORMATIONAL_QUESTIONS_index_14]
ON [T_RRHH_PERFORMANCE_INFORMATIONAL_QUESTIONS];


-- 3. Modificar la columna para que acepte varchar(MAX) --> si es max no puedo usar unique
ALTER TABLE [T_RRHH_PERFORMANCE_INFORMATIONAL_QUESTIONS]
ALTER COLUMN QUESTION varchar(MAX) NOT NULL;


ALTER TABLE [T_RRHH_PERFORMANCE_INFORMATIONAL_QUESTIONS]
ADD CONSTRAINT [CK_QUESTION_Length] CHECK (LEN(QUESTION) > 5);

---------------------//////////////////--------------------------------

-- 1. Encontrar el nombre del constraint (ya lo hiciste)
SELECT CONSTRAINT_NAME 
FROM INFORMATION_SCHEMA.CONSTRAINT_COLUMN_USAGE 
WHERE TABLE_NAME = 'T_RRHH_PERFORMANCE_EVALUATIONS_QUESTIONS' 
  AND COLUMN_NAME = 'QUESTION';
-- 2. Eliminar el constraint específico
ALTER TABLE [T_RRHH_PERFORMANCE_EVALUATIONS_QUESTIONS]
DROP CONSTRAINT [CK__T_RRHH_PE__QUEST__39AE55D6];

-- 3.Eliminar el índice dependiente
DROP INDEX [T_RRHH_PERFORMANCE_EVALUATIONS_QUESTIONS_index_11]
ON [T_RRHH_PERFORMANCE_EVALUATIONS_QUESTIONS];

-- 4. Modificar la columna para que acepte varchar(MAX)
ALTER TABLE [T_RRHH_PERFORMANCE_EVALUATIONS_QUESTIONS]
ALTER COLUMN QUESTION varchar(MAX) NOT NULL;


-- 5. Agregar nuevamente el constraint CHECK para validar longitud
ALTER TABLE [T_RRHH_PERFORMANCE_EVALUATIONS_QUESTIONS]
ADD CONSTRAINT [CK_QUESTION_Length_ev] CHECK (LEN(QUESTION) > 5);

-------------------////////////////////----------------------------------
SELECT CONSTRAINT_NAME 
FROM INFORMATION_SCHEMA.CONSTRAINT_COLUMN_USAGE 
WHERE TABLE_NAME = 'RRHH_PERFORMANCE_INFORMATIONAL_RESPONSES' 
  AND COLUMN_NAME = 'RESPONSE_TEXT';

ALTER TABLE [RRHH_PERFORMANCE_INFORMATIONAL_RESPONSES]
DROP CONSTRAINT [CK__RRHH_PERF__RESPO__45200882];

ALTER TABLE [RRHH_PERFORMANCE_INFORMATIONAL_RESPONSES]
ALTER COLUMN RESPONSE_TEXT varchar(MAX) NOT NULL;

ALTER TABLE [RRHH_PERFORMANCE_INFORMATIONAL_RESPONSES]
ADD CONSTRAINT [CK_response_Length_ev] CHECK (LEN(RESPONSE_TEXT) > 2);



-------------------////////////////////----------------------------------
SELECT *
FROM T_RRHH_PERFORMANCE_EVALUATIONS_RECOMMENDATIONS;

ALTER TABLE T_RRHH_PERFORMANCE_EVALUATIONS_RECOMMENDATIONS
ADD TempSequence INT IDENTITY(1,1);

UPDATE T_RRHH_PERFORMANCE_EVALUATIONS_RECOMMENDATIONS
SET RECOMMENDATION_NAME = CONCAT('Test ', FORMAT(TempSequence, '000'))
WHERE TempSequence IS NOT NULL;

-- Eliminar la columna temporal
ALTER TABLE T_RRHH_PERFORMANCE_EVALUATIONS_RECOMMENDATIONS
DROP COLUMN TempSequence;

SELECT CONSTRAINT_NAME 
FROM INFORMATION_SCHEMA.CONSTRAINT_COLUMN_USAGE 
WHERE TABLE_NAME = 'T_RRHH_PERFORMANCE_EVALUATIONS_RECOMMENDATIONS';

ALTER TABLE T_RRHH_PERFORMANCE_EVALUATIONS_RECOMMENDATIONS
DROP CONSTRAINT CK__T_RRHH_PE__RECOM__22CAF07E;

-- Eliminar el índice existente
DROP INDEX T_RRHH_PERFORMANCE_EVALUATIONS_RECOMMENDATIONS_index_3
ON T_RRHH_PERFORMANCE_EVALUATIONS_RECOMMENDATIONS;


ALTER TABLE T_RRHH_PERFORMANCE_EVALUATIONS_RECOMMENDATIONS
ALTER COLUMN RECOMMENDATION_NAME varchar(255) NOT NULL; 

-- Crear un índice único en RECOMMENDATION_NAME
CREATE UNIQUE INDEX IX_UniqueRecommendationName
ON T_RRHH_PERFORMANCE_EVALUATIONS_RECOMMENDATIONS (RECOMMENDATION_NAME);

ALTER TABLE T_RRHH_PERFORMANCE_EVALUATIONS_RECOMMENDATIONS
ADD RECOMMENDATION_DESCRIPTION varchar(4000) NULL;



SELECT CONSTRAINT_NAME 
FROM INFORMATION_SCHEMA.CONSTRAINT_COLUMN_USAGE 
WHERE TABLE_NAME = 'T_RRHH_PERFORMANCE_EVALUATIONS_TYPES' 
  AND COLUMN_NAME = 'QUESTION';
  
ALTER TABLE T_RRHH_PERFORMANCE_EVALUATIONS_TYPES
DROP CONSTRAINT [CK__T_RRHH_PE__TYPE___278FA59B];

ALTER TABLE T_RRHH_PERFORMANCE_EVALUATIONS_TYPES
ADD UNIQUE (TYPE_EVALUATION);




----
EXEC sp_rename 'RRHH_PERFORMANCE_QUESTION_SETS', 'T_RRHH_QUESTION_TEMPLATES';
GO

EXEC sp_rename 'T_RRHH_QUESTION_TEMPLATES', 'RRHH_PERFORMANCE_QUESTION_SETS';
GO
 SELECT * From RRHH_PERFORMANCE_QUESTION_SETS